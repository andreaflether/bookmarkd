var folder = $("<%= j render folder %>")
var removed = $('#folders').find(".folder[data-folder-id='<%= folder.id %>']")

$grid = $('#folders').imagesLoaded( function() {
  $('#folders').packery({
      itemSelector: '.folder'
  });
});

<% if folder.pinned? %>
  toastr.success("<b><%= folder.name %></b> was added to your pinned folders!")
  $grid.packery('remove', removed).packery('layout');
  $grid.prepend(folder).packery('prepended', folder);  
<% else %>
  toastr.info("<b><%= folder.name %></b> was removed from your pinned folders.")

  if($(".folder[data-pinned='true']:last").length >= 1) {
    $grid.packery('remove', removed).packery('layout')
    $(".folder[data-pinned='true']:last").after(folder)
    setTimeout(function() { 
      $grid.packery('layout')
    }, 500)
  } else {
    $grid.packery('remove', removed).packery('layout');
    $grid.prepend(folder).packery('prepended', folder)
  }
  $grid.packery('reloadItems').packery('layout')
<% end %>

initializeTippy();
